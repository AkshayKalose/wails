<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wails Alpha</title>
    <link rel="stylesheet" href="/style.css">
    <script type="module" src="/wails/runtime.js"></script>
    <script type="module">
        import * as sqlite from '/wails/plugin/sqlite/sqlite.js';
        let dbOpen = false;
        function toggleDB(event) {
            if (dbOpen) {
                sqlite.Close();
                dbOpen = false;
                event.target.innerText = "Open DB";
            } else {
                sqlite.Open("test.db");
                dbOpen = true;
                event.target.innerText = "Close DB";
            }
        }
        function runSelect() {
            let query = document.getElementById("selectquery").value;
            sqlite.Select(query).then((result) => {
                let results = document.getElementById("sqlresults");
                results.innerHTML = "";
                if (result.length === 0) {
                    results.innerHTML = "No results";
                    return;
                }
                let table = document.createElement("table");
                let header = document.createElement("tr");
                for (let key in result[0]) {
                    let th = document.createElement("th");
                    th.innerText = key;
                    header.appendChild(th);
                }
                table.appendChild(header);
                for (let row of result) {
                    let tr = document.createElement("tr");
                    for (let key in row) {
                        let td = document.createElement("td");
                        td.innerText = row[key];
                        tr.appendChild(td);
                    }
                    table.appendChild(tr);
                }
                results.appendChild(table);
            }).catch((err) => {
                // Put error in results
                document.getElementById("sqlresults").innerHTML = "<p class='error-message'>"+err+"</p>";
            });
        }
        document.getElementById("openclose").addEventListener('click', toggleDB);
        document.getElementById("runselect").addEventListener('click', runSelect);
    </script>
    <script>
        window.onload = function() {
            // Get the element with class="defaultOpen" and click on it
            let defaultOpen = document.getElementsByClassName("defaultOpen");
            if (defaultOpen.length > 0) {
                defaultOpen[0].click();
            }
        }

        function openTab(ev, tabName) {
            let i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            /* add "active" class name to event target */
            ev.currentTarget.className += " active";
        }
    </script>
</head>
<body>
<h2>Plugins</h2>
<div>
    <div class="tab">
        <button class="tablinks defaultOpen" onclick="openTab(event, 'sqlite')">SQLite</button>
        <button class="tablinks" onclick="openTab(event, 'Demo2')">Demo 2</button>
        <button class="tablinks" onclick="openTab(event, 'Demo3')">Demo 3</button>
    </div>

    <div id="sqlite" class="tabcontent">
        <p>The sqlite plugin provides easy integration with sqlite dbs.</p>
        <div>
            <p id="openclose" class="button-42">Open DB</p>
            <div style="border: 1px solid #888">
                <input type="text" id="selectquery" value="select * from Users where age > 20"><br/>
                <p id="runselect" class="button-42">Select</p>
            </div>
            <div id="sqlresults">
            </div>
        </div>
    </div>

    <div id="Demo2" class="tabcontent">
        <h5>Demo 2</h5>
        <p>Content for Demo 2.</p>
    </div>

    <div id="Demo3" class="tabcontent">
        <h5>Demo 3</h5>
        <p>Content for Demo 3.</p>
    </div>
</div>
</body>
</html>
