<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wails Alpha</title>
    <link rel="stylesheet" href="/style.css">
    <script type="module" src="/wails/runtime.js"></script>
    <script type="module">
        import * as sqlite from '/wails/plugin/sqlite/sqlite.js';
        function runSelect() {
            let query = document.getElementById("query").value;
            // If it starts with "select ", run `sqlite.Select` otherwise run `sqlite.Exec`
            let method = sqlite.Execute;
            let isSelect = false;
            if (query.toLowerCase().startsWith("select ")) {
                method = sqlite.Select;
                isSelect = true;
            }
            method(query).then((result) => {
                let results = document.getElementById("sqlresults");
                results.innerHTML = "";
                if(!isSelect) {
                    let message = "Query executed successfully";
                    if (result.length > 0) {
                        message += " - " + result;
                    }
                    results.innerHTML = message;
                    return;
                }
                if (result.length === 0) {
                    results.innerHTML = "No results";
                    return;
                }
                let table = document.createElement("table");
                let header = document.createElement("tr");
                for (let key in result[0]) {
                    let th = document.createElement("th");
                    th.innerText = key;
                    header.appendChild(th);
                }
                table.appendChild(header);
                for (let row of result) {
                    let tr = document.createElement("tr");
                    for (let key in row) {
                        let td = document.createElement("td");
                        td.innerText = row[key];
                        tr.appendChild(td);
                    }
                    table.appendChild(tr);
                }
                results.appendChild(table);
            }).catch((err) => {
                // Put error in results
                document.getElementById("sqlresults").innerHTML = "<p class='error-message'>"+err+"</p>";
            });
        }
        document.getElementById("runquery").addEventListener('click', runSelect);
    </script>
    <script>
        window.onload = function() {
            // Get the element with class="defaultOpen" and click on it
            let defaultOpen = document.getElementsByClassName("defaultOpen");
            if (defaultOpen.length > 0) {
                defaultOpen[0].click();
            }
        }

        function openTab(ev, tabName) {
            let i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            /* add "active" class name to event target */
            ev.currentTarget.className += " active";
        }
    </script>
</head>
<body>
<h2>Plugins</h2>
<div>
    <div class="tab" style="--wails-draggable: drag">
        <button class="tablinks defaultOpen" onclick="openTab(event, 'sqlite')">SQLite</button>
        <button class="tablinks" onclick="openTab(event, 'Demo2')">Demo 2</button>
        <button class="tablinks" onclick="openTab(event, 'Demo3')">Demo 3</button>
    </div>

    <div id="sqlite" class="tabcontent">
        <p>The sqlite plugin provides easy integration with sqlite dbs.</p>
        <p>The demo DB has a single table: Users.</p>
        <p>Enter a query below and hit the "Run" button.</p>
        <div>
            <div style="display: flex;justify-content: space-around;">
                <input style="width:90%" type="text" id="query" value="select * from Users where age > 20"><br/>
                <button type="button" id="runquery">Run</button>
            </div>
            <div id="sqlresults">
            </div>
        </div>
    </div>

    <div id="Demo2" class="tabcontent">
        <h5>Demo 2</h5>
        <p>Content for Demo 2.</p>
    </div>

    <div id="Demo3" class="tabcontent">
        <h5>Demo 3</h5>
        <p>Content for Demo 3.</p>
    </div>
</div>
</body>
</html>
